pico-8 cartridge // http://www.pico-8.com
version 38
__lua__
-- actop

-- global variables
g_frames=0
pl={}

-- global constants
k_atk=5

function _init()
  g_frames=0
  player.init(pl)
end

function _update()
  g_frames=(g_frames+1)%30
  player.update(pl)
end

function _draw()
  cls()
  player.draw(pl)
end
-->8
-- classes

player={
  init=function(this)
    this.x=64
    this.y=64
    this.dx=0
    this.dy=0
    this.face=3
    this.runframe=0
    this.atkframe=0
    this.atkface=0
  end,
  update=function(this)
    -- input
    this.dx=0
    this.dy=0
    if (btn(0)) then
      this.face=0
      this.dx=-1
    end
    if (btn(1)) then
      this.face=1
      this.dx=1
    end
    if (btn(2)) then
      this.face=2
      this.dy=-1
    end
    if (btn(3)) then
      this.face=3
      this.dy=1
    end
    if (btnp(k_atk) and (this.atkframe == 0)) then
      this.atkframe=3
      this.atkface=this.face
    end
    -- move
    this.x+=this.dx
    this.y+=this.dy
  end,
  draw=function(this)
    -- draw player body
    if ((this.dx == 0) and (this.dy == 0)) then -- stop
      spr(1,this.x,this.y)
    else -- move
      spr(2+this.runframe,this.x,this.y)
      if ((g_frames%5) == 0) this.runframe=(this.runframe+1)%2
    end
    -- draw player eye
    spr(this.face+12,this.x,this.y)
    -- draw atk
    if (this.atkframe > 0) then
      local atkpos=face2pos(this.atkface)
      spr(this.atkface*3+this.atkframe+15,
          this.x+atkpos.x*8,
          this.y+atkpos.y*8)
      this.atkframe-=1
    end
  end,
}

face2pos=function(face)
  local x=0
  local y=0
  if (face == 0) x=-1
  if (face == 1) x=1
  if (face == 2) y=-1
  if (face == 3) y=1
  return {x=x,y=y}
end

__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000088888800888888008888880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000088888800888888008888880000000000000000000000000000000000000000000000000000000000000000000000000000000000010010000000000
00000000088888800888888008888880000000000000000000000000000000000000000000000000000000000000000000101000000101000010010000100100
00000000088888800888888008888880000000000000000000000000000000000000000000000000000000000000000000101000000101000000000000100100
00000000088888800888888008888880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000008008000080080000800800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000008008000080000000000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000006000000076000000000000000000000000000000000000000000000055000000500000005500000600000000006000067760000000000
00000000000000000007600000760000000000000000000000000000000000000000000000056700000550000006500006000000000000600600006000000000
00000000000000000000760007600000000000000000000000000000000060000000000000000670000670000067000060000000000000066000000600000000
00000055006666550000076556000000057770005500000060000000000760000000007600000067000670000670000070000000000000070000000000000000
00000065000777500000005555000000556666005670000076000000000760000000076000000006000670006700000070000000000000070000000000000000
00000670000000000000000000000000000000000067000007600000000760000000760000000000000600000000000060000000000000060000000060000006
00006700000000000000000000000000000000000006700000765000000550000005600000000000000000000000000006000000000000600000000006000060
00067000000000000000000000000000000000000000600000055000000050000005500000000000000000000000000000600000000006000000000000677600
